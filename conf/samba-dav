#!/bin/bash -ex

SRC=/usr/local/src
WEBROOT=/var/www/webdavcgi
# SOURCE=https://github.com/DanRohde/webdavcgi.git
# RELEASE=release-1.1.1

# Due to an upstream bug we are using a fixed fork
SOURCE=https://github.com/DocCyblade/webdavcgi.git
RELEASE=1.1.1-smb-fix

git clone --depth 1 --branch $RELEASE $SOURCE $WEBROOT 

mv $SRC/webdav.conf $WEBROOT
mv $SRC/logout $WEBROOT/cgi-bin

chmod a+rx $WEBROOT $WEBROOT/cgi-bin $WEBROOT/cgi-bin/webdav.pl $WEBROOT/cgi-bin/afswrapper $WEBROOT/cgi-bin/smbwrapper
chmod -R a+r $WEBROOT

echo yes | perl -MCPAN -e 'install DateTime::Format::Human::Duration'

a2enmod rewrite
a2enmod cgi
a2enmod authnz_external

